---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - rollup.config.mjs
  - src/plugin.ts
  - manifest.json
  - .gitignore
autonomous: true
requirements:
  - UI-04

must_haves:
  truths:
    - "Plugin project scaffolded with Stream Deck SDK v2 and TypeScript"
    - "npm run build compiles without errors"
    - "manifest.json declares the plugin with correct UUID, SDK version, and Node.js 20"
  artifacts:
    - path: "package.json"
      provides: "Project dependencies including @elgato/streamdeck"
      contains: "@elgato/streamdeck"
    - path: "src/plugin.ts"
      provides: "Plugin entry point with streamDeck.connect()"
      contains: "streamDeck.connect"
    - path: "manifest.json"
      provides: "Stream Deck plugin manifest"
      contains: "SDKVersion"
    - path: "rollup.config.mjs"
      provides: "Build configuration with Node builtins externalized"
      contains: "external"
    - path: "tsconfig.json"
      provides: "TypeScript configuration"
      contains: "compilerOptions"
  key_links:
    - from: "manifest.json"
      to: "bin/plugin.js"
      via: "CodePath field"
      pattern: "CodePath.*bin/plugin"
    - from: "rollup.config.mjs"
      to: "src/plugin.ts"
      via: "entry point"
      pattern: "src/plugin"
---

<objective>
Scaffold the Stream Deck plugin project using the SDK v2 toolchain, configure TypeScript and Rollup, and establish the project structure for all subsequent plans.

Purpose: Every other plan depends on a buildable project with the SDK wired up. This must exist first.
Output: A buildable Stream Deck plugin that compiles and has the correct manifest, with the project structure ready for WLEDClient, ControllerRegistry, and discovery modules.
</objective>

<execution_context>
@C:/Users/barlo/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/barlo/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold SDK v2 project and configure build</name>
  <files>
    package.json
    tsconfig.json
    rollup.config.mjs
    src/plugin.ts
    manifest.json
    .gitignore
  </files>
  <action>
    Use the `@elgato/cli` to scaffold: `npx @elgato/cli@latest create`. If the interactive CLI is not automatable, manually create the project structure matching the SDK v2 conventions documented in RESEARCH.md.

    **package.json**: Must include dependencies `@elgato/streamdeck` and devDependencies for TypeScript, Rollup, and the Elgato CLI. Add `multicast-dns` dependency and `@types/multicast-dns` devDependency now (needed in plan 01-03).

    **manifest.json**: Set these fields exactly:
    - `UUID`: `com.barloworld.wled` (use this exact UUID)
    - `Name`: `WLED`
    - `Author`: `barloworld`
    - `Version`: `0.1.0.0`
    - `Description`: `Control WLED LED strips from Stream Deck`
    - `SDKVersion`: 2
    - `Software.MinimumVersion`: `"6.6"`
    - `OS`: Both mac (10.15+) and windows (10+)
    - `Nodejs.Version`: `"20"` with `Debug`: `"enabled"`
    - `CodePath`: `"bin/plugin.js"`
    - `Icon`: `"imgs/plugin-icon"`
    - `Category`: `"WLED"`
    - `CategoryIcon`: `"imgs/category-icon"`
    - `Actions`: `[]` (empty — actions added in Phase 2)
    - Do NOT set `PropertyInspectorPath` at the plugin level yet — that is added in plan 01-03 when the global settings HTML is created

    **rollup.config.mjs**: Ensure Node.js built-in modules are externalized: `dgram`, `os`, `dns`, `net`, `crypto`, `path`, `fs`, `http`, `https`, `url`, `stream`, `events`, `buffer`, `util`, `tls`, `zlib`, `querystring`. This is critical for `multicast-dns` which uses `dgram`. Use `@rollup/plugin-node-resolve` with `{ preferBuiltins: true }` if the scaffold provides it; otherwise add explicit `external` array.

    **src/plugin.ts**: Minimal entry point:
    ```typescript
    import streamDeck from '@elgato/streamdeck';

    async function main() {
      // ControllerRegistry.load() will be added here in plan 01-03
      await streamDeck.connect();
    }

    main().catch(console.error);
    ```

    **tsconfig.json**: Ensure `"moduleResolution": "node"` or `"bundler"`, `"strict": true`, target `"ES2022"` or later (for top-level await and AbortSignal.timeout support).

    **.gitignore**: Include `node_modules/`, `dist/`, `bin/`, `.rollup.cache/`, `*.streamDeckPlugin`.

    Create placeholder directories: `src/actions/`, `src/client/`, `src/registry/`, `src/discovery/`.

    Run `npm install` to install all dependencies.
  </action>
  <verify>
    1. `npm run build` completes without errors
    2. `bin/plugin.js` exists after build
    3. `manifest.json` contains `"SDKVersion": 2` and `"Nodejs"` section
    4. `node_modules/@elgato/streamdeck` exists
    5. `node_modules/multicast-dns` exists
    6. Directories exist: `src/actions/`, `src/client/`, `src/registry/`, `src/discovery/`
  </verify>
  <done>
    The project builds cleanly with `npm run build`, producing `bin/plugin.js`. The manifest declares a valid SDK v2 plugin targeting Node.js 20. All dependencies (including multicast-dns) are installed. The directory structure is ready for WLEDClient, ControllerRegistry, and MDNSScanner modules.
  </done>
</task>

</tasks>

<verification>
- `npm run build` exits with code 0
- `cat manifest.json | grep SDKVersion` returns 2
- `ls src/client/ src/registry/ src/discovery/ src/actions/` all succeed
- `ls node_modules/multicast-dns` succeeds
</verification>

<success_criteria>
The project is a valid Stream Deck SDK v2 TypeScript plugin that compiles without errors. All directories and dependencies for subsequent plans are in place.
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
